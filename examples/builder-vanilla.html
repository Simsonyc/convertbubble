<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConvertBubble — Builder Live NeuroBreak™ V3.0</title>

  <style>
    :root {
      --primary: linear-gradient(90deg, #ff7a18 0%, #00e0ff 100%);
      --bg: #0b0c14;
      --panel: #11131f;
      --text: #ffffff;
      --border: #1e2230;
      --input-bg: #0f111b;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      --radius: 16px;
      --transition: all 0.25s ease;
    }

    [data-theme="light"] {
      --bg: #f7f8fb;
      --panel: #ffffff;
      --text: #11131f;
      --border: #dfe3ee;
      --input-bg: #f3f4f7;
      --shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    }

    body {
      font-family: "Poppins", "Inter", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: var(--transition);
    }

    header {
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    header h1 {
      font-size: 16px;
      margin: 0;
      font-weight: 600;
      background: var(--primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .theme-toggle {
      background: var(--primary);
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      cursor: pointer;
      color: #fff;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease;
    }
    .theme-toggle:hover { transform: scale(1.1); }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
    }

    section {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: var(--shadow);
    }

    h3 {
      margin: 0 0 6px 0;
      font-size: 15px;
      font-weight: 600;
      background: var(--primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 14px;
    }

    input, select {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 14px;
      outline: none;
      transition: var(--transition);
    }

    input:focus, select:focus {
      border-color: #00e0ff;
      box-shadow: 0 0 6px rgba(0, 224, 255, 0.5);
    }

    button {
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid transparent;
      font-weight: 600;
      cursor: pointer;
      color: var(--text);
      background: #14151f;
      transition: all 0.25s ease;
    }

    button:hover {
      border-image: var(--primary) 1;
      border-width: 1px;
      background: #1c1e2b;
      color: #fff;
      box-shadow: 0 0 8px rgba(0, 224, 255, 0.4);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button#addCTA,
    button#resetCTA,
    button#open,
    button#close,
    button#download,
    button#snippet {
      background: var(--primary);
      color: #fff;
      border: none;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    iframe {
      width: 100%;
      border: none;
      border-radius: var(--radius);
      aspect-ratio: 16/9;
      background: rgba(0, 0, 0, 0.4);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px) saturate(130%);
      -webkit-backdrop-filter: blur(8px) saturate(130%);
      transition: all 0.3s ease;
    }

    @media (min-width: 768px) {
      main {
        flex-direction: row;
      }
      .builder-panel {
        flex: 1;
        max-width: 380px;
        overflow-y: auto;
        height: calc(100vh - 80px);
        padding-right: 4px;
      }
      .preview-panel {
        flex: 2;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      iframe {
        max-width: 640px;
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: #00e0ff44;
      border-radius: 10px;
    }
  </style>
</head>

<body data-theme="dark">
  <header>
    <h1>ConvertBubble — Builder NeuroBreak™</h1>
    <button class="theme-toggle" id="themeToggle"> </button>
  </header>

  <main>
    <!-- === PANNEAU DE CONFIGURATION === -->
    <div class="builder-panel">

      <!-- Thème -->
      <section>
        <h3> Thème</h3>
        <label>Couleur primaire
          <input id="primary" type="color" value="#ff7a18">
        </label>
        <label>Forme
          <select id="shape">
            <option value="circle">Rond</option>
            <option value="rounded-rect">Rectangle arrondi</option>
          </select>
        </label>
        <label>Animation
          <select id="animation">
            <option value="none">Aucune</option>
            <option value="pulse">Pulse</option>
            <option value="bounce">Bounce</option>
          </select>
        </label>
      </section>

      <!-- Branding -->
      <section>
        <h3> Branding</h3>
        <label>Label
          <input id="brandLabel" type="text" placeholder="Ex : ConvertBubble">
        </label>
        <label>Couleur header
          <input id="brandColor" type="color" value="#00e0ff">
        </label>
      </section>

      <!-- Vidéo -->
      <section>
        <h3> Vidéo</h3>
        <label>URL vidéo
          <input id="videoUrl" type="url" placeholder="https://.../video.mp4">
        </label>
        <label>Image poster
          <input id="poster" type="url" placeholder="https://.../image.jpg">
        </label>
      </section>

      <!-- CTA -->
      <section>
        <h3> CTA</h3>
        <label>Texte du bouton
          <input id="ctaLabel" type="text" placeholder="Découvrir maintenant">
        </label>
        <label>Lien du bouton
          <input id="ctaHref" type="url" placeholder="https://boostandgrow.io">
        </label>
        <div class="btn-row">
          <button id="addCTA">Ajouter</button>
          <button id="resetCTA">Réinitialiser</button>
        </div>
      </section>

      <!-- Position -->
      <section>
        <h3> Position</h3>
        <div class="btn-row">
          <button data-pos="TL">TL</button>
          <button data-pos="TR">TR</button>
          <button data-pos="BL">BL</button>
          <button data-pos="BR">BR</button>
        </div>
      </section>

      <!-- Thèmes prédéfinis -->
      <section>
        <h3> Thèmes</h3>
        <div class="btn-row">
          <button data-theme-name="coach">Coach</button>
          <button data-theme-name="agency">Agence</button>
          <button data-theme-name="infopreneur">Infopreneur</button>
        </div>
      </section>

      <!-- Export -->
      <section>
        <h3> Export</h3>
        <div class="btn-row">
          <button id="open">Ouvrir</button>
          <button id="close">Fermer</button>
          <button id="download">Télécharger JSON</button>
          <button id="snippet">Copier Snippet</button>
          <button id="resetLocal" style="background:#ff4d4d;color:#fff;border:none;">
            Effacer sauvegarde locale
          </button>
        </div>
      </section>
    </div>

    <!-- === ZONE DE PRÉVISUALISATION === -->
    <div class="preview-panel">
      <iframe id="pv" src="../public/preview.html"></iframe>
    </div>
  </main>

  <!-- === SCRIPT BUILDER === -->
  <script src="../public/cb-builder.js"></script>
  <script>
    // Dark/Light toggle
    const toggle = document.getElementById("themeToggle");
    const body   = document.body;
    toggle.onclick = () => {
      const dark = body.getAttribute("data-theme") === "dark";
      body.setAttribute("data-theme", dark ? "light" : "dark");
      toggle.textContent = dark ? " " : " ";
    };

    (async function () {
      const iframe = document.getElementById("pv");
      await Builder.init({ iframe });

      const primary    = document.getElementById("primary");
      const shape      = document.getElementById("shape");
      const animation  = document.getElementById("animation");
      const brandLabel = document.getElementById("brandLabel");
      const brandColor = document.getElementById("brandColor");
      const videoUrl   = document.getElementById("videoUrl");
      const poster     = document.getElementById("poster");
      const ctaLabel   = document.getElementById("ctaLabel");
      const ctaHref    = document.getElementById("ctaHref");
      const addCTA     = document.getElementById("addCTA");
      const resetCTA   = document.getElementById("resetCTA");
      const btnOpen    = document.getElementById("open");
      const btnClose   = document.getElementById("close");
      const btnDownload= document.getElementById("download");
      const btnSnippet = document.getElementById("snippet");
      const btnResetLocal = document.getElementById("resetLocal");

      // THEME
      primary.addEventListener("input",  e => Builder.update({ theme: { primary: e.target.value }}));
      primary.addEventListener("change", e => Builder.update({ theme: { primary: e.target.value }}));

      shape.addEventListener("change", e =>
        Builder.update({ theme: { shape: e.target.value }})
      );

      animation.addEventListener("change", e =>
        Builder.update({ animation: e.target.value })
      );

      // BRANDING
      brandLabel.addEventListener("input", e =>
        Builder.update({ branding: { label: e.target.value, enabled: true }})
      );
      brandColor.addEventListener("input", e =>
        Builder.update({ branding: { color: e.target.value }})
      );

      // VIDEO
      videoUrl.addEventListener("change", e =>
        Builder.update({ video: { src: e.target.value }})
      );
      poster.addEventListener("change", e =>
        Builder.update({ video: { poster: e.target.value }})
      );

      // CTA
      let ctas = [];
      addCTA.addEventListener("click", () => {
        const label = ctaLabel.value.trim();
        const href  = ctaHref.value.trim();
        if (!label || !href) {
          alert("Complète le label et le lien du CTA");
          return;
        }
        ctas.push({ label, href });
        Builder.update({ ctas });
      });

      resetCTA.addEventListener("click", () => {
        ctas = [];
        Builder.update({ ctas: [] });
      });

      // POSITION
      document.querySelectorAll("[data-pos]").forEach(btn => {
        btn.addEventListener("click", () =>
          Builder.update({ position: btn.dataset.pos })
        );
      });

      // THEMES PREDEFINIS
      document.querySelectorAll("[data-theme-name]").forEach(btn => {
        btn.addEventListener("click", async () => {
          const name = btn.dataset.themeName;
          try {
            const res  = await fetch(`../public/themes/${name}.json`);
            const data = await res.json();
            Builder.replace(data);
          } catch (e) {
            console.error("Erreur chargement thème", name, e);
            alert("Impossible de charger le thème " + name);
          }
        });
      });

      // EXPORT / OVERLAY
      btnOpen.addEventListener("click",  () => Builder.openOverlay());
      btnClose.addEventListener("click", () => Builder.closeOverlay());
      btnDownload.addEventListener("click", () => Builder.downloadJSON("config.json"));
      btnSnippet.addEventListener("click", async () => {
        const s = Builder.generateSnippet();
        await navigator.clipboard.writeText(s);
        alert("Snippet copié ");
      });

      // RESET LOCAL
      btnResetLocal.addEventListener("click", () => {
        if (confirm("Effacer la configuration locale ? Cette action est irréversible.")) {
          Builder.resetLocal();
          alert("Sauvegarde locale effacée ");
          location.reload();
        }
      });

      // INITIAL PUSH
      if (primary.value) Builder.update({ theme: { primary: primary.value }});
    })();
  </script>
</body>
</html> 
